# Демо: настройка MCP-серверов

## Что показываем

Подключаем три MCP-сервера к Claude Code: Google Drive, Tavily (поиск в интернете) и Filesystem. После настройки Claude сможет искать документы в облаке, находить информацию в вебе и работать с файлами в указанных папках.

Время на демо: ~15 минут на настройку + 20 минут на проверку и первые запросы.

## Подготовка

1. Убедитесь, что Claude Code запущен и работает
2. Для Google Drive: нужен аккаунт Google с файлами на диске
3. Для Tavily: получите API-ключ на tavily.com (есть бесплатный тариф на 1000 запросов/мес)
4. Для Filesystem: определите папки, к которым хотите открыть доступ

## Порядок демонстрации

### Шаг 1. Объясняем, где хранятся настройки MCP

MCP-серверы настраиваются в файле `.claude/settings.json` в корне проекта (локально) или в `~/.claude/settings.json` (глобально).

Скажите студентам:

> MCP-конфиги хранятся в JSON-файле. Можно редактировать вручную, а можно поручить Claude -- оба способа покажу.

### Шаг 2. Подключаем Filesystem MCP

Начинаем с самого простого. Откройте файл `filesystem-config.json` и покажите его содержимое.

Обратите внимание: в конфиге указаны условные пути `/Users/username/...`. Студентам нужно подставить свои реальные пути. На macOS это обычно `/Users/имя-пользователя/Documents/work`, на Linux -- `/home/имя-пользователя/...`. Можно узнать командой `echo $HOME` в терминале.

**Промпт для Claude Code:**

```
Подключи MCP-сервер Filesystem. Дай доступ только к папке ~/Documents/work и ~/Downloads. Больше никуда доступа давать не надо.
```

**Что должно произойти:**
- Claude предложит добавить конфиг в `.claude/settings.json`
- Попросит разрешение на изменение файла
- После подтверждения сервер появится в списке доступных

**На что обратить внимание студентов:**
- Filesystem MCP ограничивает доступ указанными папками -- Claude не сможет читать ничего за их пределами
- В `args` перечислены конкретные пути

**Если что-то пошло не так:**
- Claude пишет "permission denied" -- проверьте, что папка существует и у вас есть права на чтение
- Claude не понимает `~` -- подставьте полный путь: `/Users/ваше-имя/Documents/work`

### Шаг 3. Подключаем Tavily (веб-поиск)

**Промпт для Claude Code:**

```
Подключи MCP-сервер Tavily для поиска в интернете. Мой API-ключ: tvly-xxxxxxxxxxxxx
```

**Что должно произойти:**
- Claude добавит конфиг Tavily в settings.json
- API-ключ будет передан через переменную окружения

**На что обратить внимание:**
- API-ключ хранится в `env` секции конфига, а не в открытом виде в аргументах
- Tavily возвращает не ссылки, а извлеченный текст со страниц
- Бесплатного тарифа хватает для тестов (1000 запросов в месяц)

**Если что-то пошло не так:**
- "Invalid API key" -- проверьте, что ключ начинается с `tvly-` и скопирован полностью
- Если у студента нет ключа Tavily -- пусть зарегистрируется прямо на занятии, это занимает минуту

### Шаг 4. Подключаем Google Drive

**Промпт для Claude Code:**

```
Подключи MCP-сервер Google Drive. Нужна авторизация через OAuth.
```

**Что должно произойти:**
- Claude добавит конфиг Google Drive
- При первом использовании откроется браузер для авторизации
- После авторизации Claude сможет читать файлы на диске

**На что обратить внимание:**
- OAuth-авторизация делается один раз, потом токен сохраняется
- Claude видит файлы через API Google Drive -- он не скачивает весь диск
- Можно использовать с любым аккаунтом Google

**Важно:** Пакет Google Drive MCP менялся. В файле `google-drive-config.json` указан `@modelcontextprotocol/server-gdrive` -- это актуальное на момент подготовки курса имя пакета (раньше был `@anthropic/mcp-gdrive`). Перед занятием проверьте, что пакет работает: выполните `npx -y @modelcontextprotocol/server-gdrive --help` в терминале. Если пакет переименовался, обновите конфиг.

**Если что-то пошло не так:**
- Браузер не открылся для OAuth -- скопируйте URL из терминала вручную
- Корпоративный Google-аккаунт может блокировать OAuth -- используйте личный
- Если настройка OAuth слишком долгая на занятии -- покажите на своем экране и переходите к следующему демо

### Шаг 5. Проверяем, что все работает

**Промпт для проверки:**

```
Какие MCP-серверы у тебя сейчас подключены? Перечисли их и проверь, что каждый отвечает.
```

**Ожидаемый результат:** Claude покажет список из трех серверов и подтвердит, что каждый доступен.

**Пример вывода:**

```
Подключено 3 MCP-сервера:
1. Filesystem -- доступ к ~/Documents/work и ~/Downloads. Статус: OK.
2. Tavily -- веб-поиск. Статус: OK.
3. Google Drive -- доступ к файлам на диске. Статус: OK.
```

## Файлы-примеры конфигов

В этой папке лежат три примера конфигурации. Каждый можно скопировать в `.claude/settings.json` вручную или поручить это Claude.

- `filesystem-config.json` -- доступ к конкретным папкам (замените `/Users/username/...` на свои пути)
- `tavily-config.json` -- веб-поиск через Tavily
- `google-drive-config.json` -- доступ к Google Drive (проверьте актуальность пакета перед занятием, см. примечание в шаге 4)

## Частые проблемы

**"MCP server not found" после добавления конфига**
- Перезапустите Claude Code (выйдите и зайдите заново)
- Проверьте, что npx установлен и работает: `npx --version`

**Tavily возвращает ошибку авторизации**
- Проверьте, что API-ключ верный
- Убедитесь, что ключ в `env` секции, а не в `args`

**Google Drive не авторизуется**
- Попробуйте в другом браузере
- Проверьте, что не включен корпоративный VPN, блокирующий OAuth

**Filesystem MCP не видит папку**
- Проверьте, что путь абсолютный (начинается с `/` или `~`)
- Убедитесь, что папка существует на диске
