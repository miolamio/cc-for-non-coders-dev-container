# Демо: Slash-команды и Hooks

## Что делаем

Показываем два инструмента для автоматизации повторяющихся задач:
- Slash-команды -- готовые промпты, которые вызываются через `/имя-команды`
- Hooks -- автоматические действия при определённых событиях (файл записан, команда выполнена и т.д.)

## Время выполнения

- Создание и демонстрация slash-команд: 10-15 минут (не зависит от модели, это файлы с промптами)
- Демонстрация hooks: 10-15 минут
- Общее время с вопросами: 20-30 минут

## Файлы в папке

```
slash-commands-and-hooks/
+-- .claude/
|   +-- commands/
|   |   +-- weekly-report.md      <-- slash-команда /weekly-report
|   |   +-- client-brief.md       <-- slash-команда /client-brief
|   +-- settings.json             <-- конфигурация hooks
+-- README.md
```

## Часть 1: Slash-команды

### Что объясняем

Slash-команды -- это markdown-файлы в папке `.claude/commands/`. Каждый файл -- один промпт. Имя файла (без .md) -- имя команды. Студент вводит `/weekly-report` в Claude Code, и Claude выполняет инструкции из файла.

### Что показываем

1. Откройте файл `.claude/commands/weekly-report.md` и покажите содержимое
2. Объясните структуру: это обычный текст с инструкциями для Claude
3. Обратите внимание: команда ссылается на файлы из других демо этого занятия (quarterly-results.csv, meeting-transcript.md). При вызове Claude найдёт и обработает эти файлы.
4. Покажите вторую команду -- `client-brief.md`. В ней используется `$ARGUMENTS` для передачи аргументов, а данные берутся из evaluation-data.csv (360-оценка) и meeting-transcript.md

### Как использовать

```
# Без аргументов — собирает еженедельный отчёт из квартальных данных и расшифровки
/weekly-report

# С аргументом — формирует бриф по сотруднику из 360-оценки
/client-brief Алексей Петров
```

### Пример результата

Для `/weekly-report` -- файл reports/weekly-report-2026-02-14.md:
```
# Еженедельный отчёт 10 февраля — 14 февраля

## Финансовые итоги
Общая выручка за декабрь: 12 890 000 руб. (+8.4% к ноябрю)
B2B: 6 120 000 (47.5% от общей), рост третий месяц подряд
Техподдержка: расходы превышают выручку на 270 000

## Ключевые решения (совещание 14.02)
1. Утверждены 3 пакета AI-консалтинга
2. Маркетинговый бюджет: 250 000 руб.
...
```

Для `/client-brief Алексей Петров` -- файл briefs/Алексей Петров-2026-02-14.md с данными из 360-оценки и упоминаниями на совещании.

### Что показать студентам

- Промпт в файле -- обычный текст, никакого кода
- Можно менять промпт, и поведение команды изменится сразу
- `$ARGUMENTS` -- единственная "переменная", которую нужно знать. Всё, что написано после имени команды, подставляется вместо `$ARGUMENTS`
- Команды хранятся в проекте. Если передать папку коллеге, команды будут работать у него тоже

### Практическое задание для студентов

Попросите создать свою команду прямо на занятии:

```
Создай slash-команду /morning-digest, которая:
1. Читает файл tasks.md с задачами на сегодня
2. Проверяет calendar.csv на встречи
3. Формирует утреннюю сводку: задачи по приоритету, расписание встреч, напоминания
```

## Часть 2: Hooks

### Что объясняем

Hooks -- автоматические действия, которые Claude Code выполняет при определённых событиях. Настраиваются в `.claude/settings.json` (проектный уровень) или через `/hooks` в интерактивном режиме.

### Типы хуков

- **PreToolUse** -- перед выполнением инструмента (можно заблокировать опасные команды)
- **PostToolUse** -- после выполнения (можно проверить результат)
- **Notification** -- при уведомлении от Claude Code (можно отправить системное уведомление)

### Что показываем

Откройте `.claude/settings.json` и разберите три примера:

**1. Защита от опасных команд (PreToolUse)**
```json
{
  "matcher": "Bash",
  "hooks": [{
    "type": "command",
    "command": "if echo \"$CC_TOOL_INPUT_COMMAND\" | grep -qE 'rm\\s+-rf|sudo|chmod 777'; then echo 'BLOCK: опасная команда заблокирована'; exit 1; fi"
  }]
}
```
Перед выполнением любой bash-команды проверяет, нет ли в ней `rm -rf`, `sudo` или `chmod 777`. Если есть -- блокирует.

**2. Проверка CSV после записи (PostToolUse)**
```json
{
  "matcher": "Write|Edit",
  "hooks": [{
    "type": "command",
    "command": "if echo \"$CC_TOOL_RESULT_FILE_PATH\" | grep -q '\\.csv$'; then head -1 \"$CC_TOOL_RESULT_FILE_PATH\" | awk -F',' '{print \"CSV: \" NF \" columns\"}'; fi"
  }]
}
```
После записи или редактирования файла проверяет: если это CSV, выводит количество столбцов. Простая валидация.

**3. Системное уведомление (Notification)**

macOS:
```json
{
  "hooks": [{
    "type": "command",
    "command": "osascript -e 'display notification \"$CC_NOTIFICATION_MESSAGE\" with title \"Claude Code\"'"
  }]
}
```

Linux (альтернатива для участников с Linux):
```json
{
  "hooks": [{
    "type": "command",
    "command": "notify-send 'Claude Code' \"$CC_NOTIFICATION_MESSAGE\""
  }]
}
```

Когда Claude Code завершает задачу, система покажет уведомление. Полезно, если Claude работает в фоне. В файле settings.json настроен вариант для macOS. Участники с Linux могут заменить `osascript` на `notify-send` (пакет libnotify, обычно предустановлен в Ubuntu/Fedora).

### Переменные окружения для хуков

- `$CC_TOOL_INPUT_COMMAND` -- текст команды (для Bash)
- `$CC_TOOL_RESULT_FILE_PATH` -- путь к файлу (для Write/Edit)
- `$CC_NOTIFICATION_MESSAGE` -- текст уведомления

### Практическое задание для студентов

```
Настрой hook, который после каждой записи markdown-файла считает количество слов и выводит результат. Используй тип PostToolUse с матчером Write.
```

## Что может пойти не так

**Slash-команда не находится.** Файл должен лежать строго в `.claude/commands/` в корне проекта. Если Claude Code запущен из другой директории, команда не найдётся.

**Hook не срабатывает.** Проверьте: settings.json в правильном месте? JSON валидный? Matcher совпадает с именем инструмента?

**Hook блокирует нужные команды.** Например, хук на `rm -rf` заблокирует и `rm -rf temp/` (безобидная очистка). Хуки нужно настраивать аккуратно.

**На Windows/Linux osascript не работает.** Уведомление через osascript -- только macOS. На Linux используйте `notify-send` (пример выше). На Windows -- `powershell -Command "New-BurntToastNotification -Text 'Claude Code', '$CC_NOTIFICATION_MESSAGE'"` (требует модуль BurntToast).
