# Демо: Чистка данных в CRM-выгрузке

## Что здесь

Файл `crm-export.csv` -- выгрузка из CRM-системы на ~5200 строк. Данные накапливались несколько лет разными менеджерами, поэтому бардак типичный для любой компании:

- Даты в 4 форматах: `DD.MM.YYYY`, `MM/DD/YYYY`, `YYYY-MM-DD`, и текстом ("15 марта 2025")
- "Москва" написана 8 способами: Москва, москва, МСК, мск, г. Москва, г.Москва, M., Мoсква (с латинской "o")
- Другие города тоже с вариациями: СПб / Санкт-Петербург / Питер, ЕКБ / Екатеринбург, и т.д.
- Телефоны: +7, 8, со скобками, с дефисами, слитно -- полный набор
- ~200 дублей: одни и те же люди с небольшими различиями (другой телефон, город написан иначе, отчество то есть, то нет)
- Пустые поля: email, телефон, компания, сумма -- местами пропущены
- Суммы в разных форматах: "500000", "1 500 000", "200000 руб.", "80000 р."

Разделитель -- точка с запятой.

### Примеры дублей в данных

Вот несколько конкретных примеров, которые Claude должен поймать:

1. **Строка 6 и строка 14** -- ПАВЕЛ ВАСИЛЬЕВ (Михайлович, мск, ИП Козлова) и ТИМУР ВАСИЛЬЕВ (Владимирович, г.Москва). Разные люди с одной фамилией, но оба написаны КАПСОМ -- Claude должен нормализовать регистр, не склеивая их. А вот Васильева Екатерина (строка 2506) -- третий человек с той же фамилией.

2. **Строка 2509 и строка 2517** -- Кирилл Киселёв. В первом случае без отчества, Аналитик, г. Москва, Альфа-Групп. Во втором -- Николаевич, Финансовый директор, M., Смарт Солюшнс. Разные должности и компании, но имя и фамилия совпадают. Скорее всего дубль -- человек сменил работу.

3. **Строка 10 и строка 2516** -- татьяна комарова (г. Самара, без email) и Наталья Комарова (г. Новосибирск, с email). Разные имена, одна фамилия -- это НЕ дубль. Claude не должен их склеивать.

## Время

На Claude Pro/Max: ~1-2 минуты (анализ) + ~1-2 минуты (нормализация).
На GLM 4.7: ~2-3 минуты (анализ) + ~2-4 минуты (нормализация).

Демо идёт в два шага, между ними пауза для обсуждения. Общее время с обсуждением -- около 10 минут.

## Цель демо

Показать, что Claude Code справляется с грязными данными, которые в Excel пришлось бы чистить вручную часами. Описываешь проблему словами -- Claude находит и исправляет.

## Подготовка

1. Открыть терминал в папке `crm-cleanup/`
2. Запустить Claude Code
3. Можно заранее открыть CSV в любом редакторе, чтобы показать масштаб бардака

## Промпт для демонстрации

### Шаг 1: Анализ проблем

```
Посмотри файл crm-export.csv. Это выгрузка из CRM. Проанализируй качество данных: какие проблемы видишь? Сколько дублей? В каких форматах даты? Как написаны города?
```

Claude прочитает файл и выдаст отчёт о проблемах. Покажите это первым -- студенты увидят, что Claude сам находит паттерны.

### Шаг 2: Нормализация

```
Приведи данные в порядок:
1. Все даты в формат DD.MM.YYYY
2. Города: нормализуй написание (Москва, Санкт-Петербург, Екатеринбург и т.д., без "г." и сокращений)
3. Телефоны: единый формат +7 (XXX) XXX-XX-XX
4. Суммы: только числа, без "руб." и пробелов
5. Найди и отметь дубли (одно и то же имя + фамилия с разными данными)
6. Сохрани результат в cleaned-crm.csv
```

## Что произойдёт

Claude Code:
1. Прочитает CSV целиком (5200 строк -- не проблема)
2. Напишет скрипт на Python для обработки
3. Нормализует каждое поле по правилам
4. Найдёт дубли по совпадению имя+фамилия (или по fuzzy matching)
5. Сохранит очищенный файл
6. Выведет статистику: сколько исправлено, сколько дублей найдено

## Пример результата

После первого промпта (анализ) Claude выдаст что-то вроде:

```
Проанализировал crm-export.csv (5200 записей, 14 колонок).

Проблемы с данными:

Даты (4 формата):
- DD.MM.YYYY: 1842 записи (35%)
- MM/DD/YYYY: 1310 записей (25%)
- YYYY-MM-DD: 1205 записей (23%)
- Текстовый ("15 марта 2025"): 843 записи (16%)

Города (основные вариации):
- Москва: 8 написаний (Москва, москва, МСК, мск, г. Москва, г.Москва, M., Мoсква)
- Санкт-Петербург: 5 написаний (СПб, спб, С.-Петербург, г. Санкт-Петербург, Питер)
- Екатеринбург: 3 написания (Екатеринбург, Екб, ЕКБ)

Дубли: ~190-210 записей с совпадением имя+фамилия

Пустые поля: email отсутствует у 820 записей, телефон -- у 630
```

После второго промпта (нормализация) -- файл `cleaned-crm.csv`, где все даты в DD.MM.YYYY, города унифицированы, телефоны в формате +7 (XXX) XXX-XX-XX, дубли помечены.

## На что обратить внимание студентов

1. Claude нашёл проблемы сам. Не пришлось говорить "там Москва написана по-разному" -- он сам увидел 8 вариантов.

2. Латинская "o" в "Мoсква". Частая проблема в данных -- символы выглядят одинаково, но имеют разные коды. Claude это ловит.

3. Дубли -- не точные совпадения. Один человек может быть записан с отчеством и без, с разными телефонами. Claude использует нечёткое сравнение.

4. 5200 строк -- не предел. Claude спокойно работает с файлами на десятки тысяч строк. Ограничение -- память контекста, но для табличных данных порог высокий.

5. Скрипт можно запускать повторно. Claude написал Python-скрипт -- его можно использовать для новых выгрузок.

## Вариации

Если хотите усложнить:

```
Добавь колонку "Дубль" с номером ID оригинальной записи. Для дублей -- объедини данные: если у одной записи есть email, а у другой телефон, возьми оба.
```

Или для перехода к теме формулировок:

```
Сделай сводку: сколько контактов по городам, сколько без email, сколько без телефона, средняя сумма сделки по статусу.
```

## Если что-то пошло не так

Claude обработал только первые 100 строк:
```
Обработай весь файл целиком, все 5200 строк. Если скрипт работает только с частью данных -- исправь.
```

Не находит дубли (или находит слишком мало):
```
Ищи дубли по нечёткому совпадению имени и фамилии. Учитывай, что отчество может быть в одной записи и отсутствовать в другой. Также проверь записи, где имя и фамилия перепутаны местами.
```

Скрипт падает с ошибкой:
```
Скрипт упал. Добавь обработку ошибок: если строка не парсится -- пропусти и запиши в лог. В конце покажи, сколько строк не удалось обработать.
```

Города нормализовались неправильно (например, "Ростов н/Д" стал "Ростов"):
```
Вот правильные названия городов: Москва, Санкт-Петербург, Екатеринбург, Новосибирск, Казань, Самара, Нижний Новгород, Ростов-на-Дону, Краснодар. Приведи все вариации к этим написаниям.
```

## Возможные проблемы

| Ситуация | Что делать |
|----------|------------|
| Claude обрабатывает только часть файла | Убедиться, что он прочитал весь CSV. Сказать: "Обработай все 5200 строк, не только первые" |
| Не находит дубли с латинской "o" | Подсказать: "Проверь символы Unicode -- Мoсква с латинской o и Москва с кириллической" |
| Пишет скрипт, но не запускает | Сказать: "Запусти скрипт и покажи результат" |
| Скрипт падает на нестандартных строках | Попросить: "Добавь обработку ошибок -- пропускай строки, которые не удалось разобрать" |
